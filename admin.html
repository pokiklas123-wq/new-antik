<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.05);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border-top: 5px solid #4361ee;
        }
        
        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            color: #4cc9f0;
            margin: 10px 0;
        }
        
        .rooms-table {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: rgba(67, 97, 238, 0.3);
            padding: 15px;
            text-align: right;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .live-badge {
            background: #06d6a0;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .offline-badge {
            background: #ef476f;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .refresh-btn {
            background: #4361ee;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        
        .server-info {
            background: rgba(6, 214, 160, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            border: 1px dashed #06d6a0;
        }
        
        .spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid #4361ee;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h1>
            <p>Ø§Ù„Ø³ÙŠØ±ÙØ±: <strong>https://new-antik-p2p-20.onrender.com</strong></p>
            <p>Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­ÙŠØ© Ù„Ù„ØºØ±Ù Ø§Ù„Ù†Ø´Ø·Ø© ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
        </header>
        
        <div class="controls">
            <button class="refresh-btn" onclick="loadStats()">
                ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
            <button class="refresh-btn" onclick="loadStats(true)">
                â±ï¸ ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ (10 Ø«ÙˆØ§Ù†ÙŠ)
            </button>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>ğŸ  Ø§Ù„ØºØ±Ù Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                <div class="stat-number" id="totalRooms">0</div>
                <p>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: ØºÙŠØ± Ù…Ø­Ø¯Ø¯</p>
            </div>
            
            <div class="stat-card">
                <h3>ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†</h3>
                <div class="stat-number" id="totalUsers">0</div>
                <p>Ù…Ø¹Ù„Ù…ÙŠÙ† + Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†</p>
            </div>
            
            <div class="stat-card">
                <h3>ğŸ¥ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h3>
                <div class="stat-number" id="activeBroadcasts">0</div>
                <p>Ø¨Ø« Ù†Ø´Ø· Ø­Ø§Ù„ÙŠØ§Ù‹</p>
            </div>
            
            <div class="stat-card">
                <h3>â° ÙˆÙ‚Øª Ø§Ù„ØªØ´ØºÙŠÙ„</h3>
                <div class="stat-number" id="uptime">0</div>
                <p>Ø«Ø§Ù†ÙŠØ© Ù…Ù†Ø° Ø§Ù„ØªØ­Ø¯ÙŠØ«</p>
            </div>
        </div>
        
        <div class="rooms-table">
            <h2 style="margin-bottom: 20px;">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØºØ±Ù Ø§Ù„Ù†Ø´Ø·Ø©</h2>
            <div id="loading" class="spinner"></div>
            <table id="roomsTable" style="display: none;">
                <thead>
                    <tr>
                        <th>Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ©</th>
                        <th>Ø§Ù„Ù…Ø¹Ù„Ù…</th>
                        <th>Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>Ù…Ø¯Ø© Ø§Ù„Ø¨Ø«</th>
                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
                    </tr>
                </thead>
                <tbody id="roomsBody">
                    <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                </tbody>
            </table>
            <p id="noRooms" style="text-align: center; padding: 20px; display: none;">
                Ù„Ø§ ØªÙˆØ¬Ø¯ ØºØ±Ù Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹
            </p>
        </div>
        
        <div class="server-info">
            <h3>ğŸ–¥ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ±ÙØ±</h3>
            <p>Ø§Ù„Ø±Ø§Ø¨Ø·: <code>https://new-antik-p2p-20.onrender.com</code></p>
            <p>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="lastUpdate">--:--:--</span></p>
            <p>Ø§Ù„Ø­Ø§Ù„Ø©: <span id="serverStatus" style="color: #06d6a0;">â— Ù†Ø´Ø·</span></p>
        </div>
    </div>
    
    <script>
        let autoRefreshInterval = null;
        let startTime = new Date();
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        async function loadStats(auto = false) {
            if (auto) {
                if (autoRefreshInterval) clearInterval(autoRefreshInterval);
                autoRefreshInterval = setInterval(() => loadStats(false), 10000);
                return;
            }
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('roomsTable').style.display = 'none';
            document.getElementById('noRooms').style.display = 'none';
            
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                if (data.success) {
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    document.getElementById('totalRooms').textContent = data.totalRooms;
                    document.getElementById('totalUsers').textContent = data.totalUsers;
                    document.getElementById('activeBroadcasts').textContent = data.activeBroadcasts;
                    
                    // ÙˆÙ‚Øª Ø§Ù„ØªØ´ØºÙŠÙ„
                    const now = new Date();
                    const uptime = Math.floor((now - startTime) / 1000);
                    document.getElementById('uptime').textContent = uptime;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
                    updateRoomsTable(data.rooms);
                    
                    // Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
                    document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('ar-SA');
                    
                } else {
                    throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£:', error);
                document.getElementById('roomsBody').innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; color: #ef476f;">
                            Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}
                        </td>
                    </tr>
                `;
                document.getElementById('roomsTable').style.display = 'table';
            }
            
            document.getElementById('loading').style.display = 'none';
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØºØ±Ù
        function updateRoomsTable(rooms) {
            const tbody = document.getElementById('roomsBody');
            tbody.innerHTML = '';
            
            if (!rooms || rooms.length === 0) {
                document.getElementById('noRooms').style.display = 'block';
                document.getElementById('roomsTable').style.display = 'none';
                return;
            }
            
            rooms.forEach(room => {
                const row = document.createElement('tr');
                
                // Ø­Ø³Ø§Ø¨ Ù…Ø¯Ø© Ø§Ù„Ø¨Ø«
                const createdAt = new Date(room.createdAt);
                const now = new Date();
                const duration = Math.floor((now - createdAt) / 1000);
                const durationStr = formatDuration(duration);
                
                row.innerHTML = `
                    <td><strong>${room.roomId}</strong></td>
                    <td>${room.broadcaster || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                    <td>${room.viewersCount || 0}/20</td>
                    <td>
                        <span class="${room.isLive ? 'live-badge' : 'offline-badge'}">
                            ${room.isLive ? 'Ù…Ø¨Ø§Ø´Ø± â—' : 'Ù…ØªÙˆÙ‚Ù â—'}
                        </span>
                    </td>
                    <td>${durationStr}</td>
                    <td>${new Date(room.createdAt).toLocaleString('ar-SA')}</td>
                `;
                
                tbody.appendChild(row);
            });
            
            document.getElementById('roomsTable').style.display = 'table';
        }
        
        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø¯Ø©
        function formatDuration(seconds) {
            if (seconds < 60) return `${seconds} Ø«Ø§Ù†ÙŠØ©`;
            if (seconds < 3600) return `${Math.floor(seconds / 60)} Ø¯Ù‚ÙŠÙ‚Ø©`;
            return `${Math.floor(seconds / 3600)} Ø³Ø§Ø¹Ø©`;
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            
            // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
            autoRefreshInterval = setInterval(() => loadStats(false), 10000);
            
            // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„ØªØ´ØºÙŠÙ„ ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
            setInterval(() => {
                const now = new Date();
                const uptime = Math.floor((now - startTime) / 1000);
                document.getElementById('uptime').textContent = uptime;
            }, 1000);
        });
        
        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ±Ùƒ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('beforeunload', () => {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        });
    </script>
</body>
</html>
